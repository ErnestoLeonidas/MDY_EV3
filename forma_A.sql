/* ELIMINACION DE TABLAS */
   -- Se borran las tablas de adentro-fuera
DROP TABLE BOLETA;
DROP TABLE CLIENTE;
DROP TABLE EMPLEADO;
DROP TABLE DETALLE_BOLETA;
DROP TABLE PRODUCTO;
DROP TABLE FABRICA;
DROP TABLE EQUIPO;
DROP TABLE CATEGORIZACION;
DROP TABLE COMUNA;

DROP SEQUENCE SEC_ID_FABRICA;
DROP SEQUENCE SEC_ID_COMUNA;
DROP SEQUENCE SEC_ID_BOLETA;


/* CREACION DE TABLAS */

-- Comando para setear el formato de FECHA DE ORACLE
-- Ejecutar antes de los insert o al principio de todo
ALTER SESSION SET NLS_DATE_FORMAT = 'DD/MM/YY';

CREATE TABLE EQUIPO(
   ID_EQUIPO   VARCHAR2(1) NOT NULL,
   NOM_EQUIPO  VARCHAR2(10) not null,
   PORC        FLOAT
);

CREATE TABLE CATEGORIZACION(
   ID_CATEGORIZACION    VARCHAR2(1) not null,
   NOM_CATEGORIZACION   VARCHAR2(10) not null,
   PORCENTAJE           FLOAT
);

CREATE TABLE EMPLEADO(
   ID_EMPLEADO       NUMBER not null,
   RUT_EMPLEADO      VARCHAR2(10) CONSTRAINT UN_rut_empleado UNIQUE,
   NOMBRES           VARCHAR2(25) not null,
   PATERNO           VARCHAR2(15) not null,
   MATERNO           VARCHAR2(15),
   FERNAC            DATE not null,
   FECCONTRATO       DATE not null,
   SUELDO            NUMBER not null,
   COMISION          NUMBER not null CONSTRAINT CHK_COMISION_EMPLEADO 
                                       CHECK (COMISION > 0.11 AND COMISION < 0.26),
   ID_EQUIPO         VARCHAR2(1),
   ID_CATEGORIZACION VARCHAR2(1) not null
);


CREATE TABLE COMUNA(
   ID_COMUNA      NUMBER(3) not null,
   NOM_COMUNA     VARCHAR2(20) not null
);

CREATE TABLE CLIENTE(
   ID_CLIENTE        NUMBER not null,
   NOMBRE_CLIENTE    VARCHAR2(35) not null,
   DIRECCION         VARCHAR2(50) not null,
   TELEFONO          VARCHAR2(15) not null,
   ID_COMUNA         NUMBER(3) not null
);

CREATE TABLE FABRICA(
   ID_FABRICA     NUMBER(4) NOT NULL,
   NOM_FABRICA    VARCHAR2(60) not null
);

CREATE TABLE PRODUCTO(
   ID_PRODUCTO       NUMBER not null,
   NOM_PRODUCTO      VARCHAR2(25) not null,
   PRECIO            NUMBER not null,
   STOCK_ACTUAL      NUMBER(4) CHECK(STOCK_ACTUAL > 0), 
   STOCK_MINIMO      NUMBER(4) CHECK(STOCK_MINIMO > 0),
      CHECK(STOCK_MINIMO < STOCK_ACTUAL),
   ID_FABRICA        NUMBER(4) not null
);


CREATE TABLE BOLETA(
   ID_BOLETA      NUMBER not null,
   ID_CLIENTE     NUMBER not null,
   ID_EMPLEADO    NUMBER not null,
   FECHA_BOLETA   DATE DEFAULT SYSDATE
);

CREATE TABLE DETALLE_BOLETA(
   ID_BOLETA      NUMBER not null,
   ID_PRODUCTO    NUMBER not null,
   CANTIDAD       NUMBER not null
);



/* CREACION DE LLAVES PRIMARIAS PK */
ALTER TABLE EQUIPO
   ADD CONSTRAINT PK_ID_EQUIPO PRIMARY KEY (ID_EQUIPO);

ALTER TABLE CATEGORIZACION
   ADD CONSTRAINT PK_ID_CATEGORIZACION PRIMARY KEY (ID_CATEGORIZACION);

ALTER TABLE EMPLEADO
   ADD CONSTRAINT PK_ID_EMPLEADO PRIMARY KEY (ID_EMPLEADO);

ALTER TABLE FABRICA
   ADD CONSTRAINT PK_ID_FABRICA PRIMARY KEY (ID_FABRICA);

ALTER TABLE PRODUCTO
   ADD CONSTRAINT PK_ID_PRODUCTO PRIMARY KEY (ID_PRODUCTO);

ALTER TABLE COMUNA
   ADD CONSTRAINT PK_ID_COMUNA PRIMARY KEY (ID_COMUNA);

ALTER TABLE CLIENTE
   ADD CONSTRAINT PK_ID_CLIENTE PRIMARY KEY (ID_CLIENTE);

ALTER TABLE BOLETA
   ADD CONSTRAINT PK_ID_BOLETA PRIMARY KEY (ID_BOLETA);

ALTER TABLE DETALLE_BOLETA
   ADD CONSTRAINT PK_DETALLE_BOLETA PRIMARY KEY (ID_BOLETA, ID_PRODUCTO);




/* CREACION DE LLAVES FORANEAS FK */

ALTER TABLE EMPLEADO
   ADD CONSTRAINT FK_ID_EQUI_EMP FOREIGN KEY (ID_EQUIPO)
   REFERENCES EQUIPO (ID_EQUIPO);

ALTER TABLE EMPLEADO
   ADD CONSTRAINT FK_ID_CATEG_EMP FOREIGN KEY (ID_CATEGORIZACION)
   REFERENCES CATEGORIZACION (ID_CATEGORIZACION);

ALTER TABLE CLIENTE
   ADD CONSTRAINT FK_ID_COMU_CLI FOREIGN KEY (ID_COMUNA)
   REFERENCES COMUNA (ID_COMUNA);

ALTER TABLE PRODUCTO
   ADD CONSTRAINT FK_ID_FABRI_PRO FOREIGN KEY (ID_FABRICA)
   REFERENCES FABRICA (ID_FABRICA);

ALTER TABLE BOLETA
   ADD CONSTRAINT FK_ID_EMPLE_BO FOREIGN KEY (ID_EMPLEADO)
   REFERENCES EMPLEADO (ID_EMPLEADO);

ALTER TABLE BOLETA
   ADD CONSTRAINT FK_ID_CLI_BO FOREIGN KEY (ID_CLIENTE)
   REFERENCES CLIENTE (ID_CLIENTE);

/* CREANDO SECUENCIA */

CREATE SEQUENCE SEC_ID_FABRICA
INCREMENT BY 5
START WITH 5
MAXVALUE 9999
NOCYCLE;

CREATE SEQUENCE SEC_ID_COMUNA
INCREMENT BY 2
START WITH 100
MAXVALUE 9999
NOCYCLE;

CREATE SEQUENCE SEC_ID_BOLETA
INCREMENT BY 10
START WITH 1010
MAXVALUE 9999
NOCYCLE;


/* INSERTAR DATOS */

INSERT INTO COMUNA (ID_COMUNA, NOM_COMUNA) VALUES (SEC_ID_COMUNA.NEXTVAL, 'PROVIDENCIA');
INSERT INTO COMUNA (ID_COMUNA, NOM_COMUNA) VALUES (SEC_ID_COMUNA.NEXTVAL, 'SANTIAGO');
INSERT INTO COMUNA (ID_COMUNA, NOM_COMUNA) VALUES (SEC_ID_COMUNA.NEXTVAL, 'NUNOA');
INSERT INTO COMUNA (ID_COMUNA, NOM_COMUNA) VALUES (SEC_ID_COMUNA.NEXTVAL, 'LA FLORIDA');
INSERT INTO COMUNA (ID_COMUNA, NOM_COMUNA) VALUES (SEC_ID_COMUNA.NEXTVAL, 'MAIPU');
INSERT INTO COMUNA (ID_COMUNA, NOM_COMUNA) VALUES (SEC_ID_COMUNA.NEXTVAL, 'LO BARNECHEA');
INSERT INTO COMUNA (ID_COMUNA, NOM_COMUNA) VALUES (SEC_ID_COMUNA.NEXTVAL, 'MACUL');
INSERT INTO COMUNA (ID_COMUNA, NOM_COMUNA) VALUES (SEC_ID_COMUNA.NEXTVAL, 'SAN MIGUEL');
INSERT INTO COMUNA (ID_COMUNA, NOM_COMUNA) VALUES (SEC_ID_COMUNA.NEXTVAL, 'RECOLETA');

INSERT INTO CLIENTE (ID_CLIENTE, NOMBRE_CLIENTE, DIRECCION, TELEFONO, ID_COMUNA) VALUES (1, 'ALCARAZ NOVOA MONSERRAT', 'RUBEN BARRALES 1630', '564522114', 102);
INSERT INTO CLIENTE (ID_CLIENTE, NOMBRE_CLIENTE, DIRECCION, TELEFONO, ID_COMUNA) VALUES (2, 'JIMENEZ LORCA ELENA', 'AV. BUSTAMANTE 529 DPTO. K', '566665443', 100);
INSERT INTO CLIENTE (ID_CLIENTE, NOMBRE_CLIENTE, DIRECCION, TELEFONO, ID_COMUNA) VALUES (3, 'TORRES COCA MARIA', 'DONATELLO 7421', '565626134', 104);
INSERT INTO CLIENTE (ID_CLIENTE, NOMBRE_CLIENTE, DIRECCION, TELEFONO, ID_COMUNA) VALUES (4, 'LOPEZ ROJAS THOMAS', 'LORCA 2007', '562989233', 108);

INSERT INTO EQUIPO (ID_EQUIPO, NOM_EQUIPO, PORC) VALUES ('A', 'EQUIPO A', 8.56);
INSERT INTO EQUIPO (ID_EQUIPO, NOM_EQUIPO, PORC) VALUES ('B', 'EQUIPO B', 10.48);
INSERT INTO EQUIPO (ID_EQUIPO, NOM_EQUIPO, PORC) VALUES ('C', 'EQUIPO C', 11.27);
INSERT INTO EQUIPO (ID_EQUIPO, NOM_EQUIPO, PORC) VALUES ('D', 'EQUIPO D', 7.24);

INSERT INTO CATEGORIZACION (ID_CATEGORIZACION, NOM_CATEGORIZACION, PORCENTAJE) VALUES('A', 'LISTA A', 17.5);
INSERT INTO CATEGORIZACION (ID_CATEGORIZACION, NOM_CATEGORIZACION, PORCENTAJE) VALUES('B', 'LISTA B', 12.6);
INSERT INTO CATEGORIZACION (ID_CATEGORIZACION, NOM_CATEGORIZACION, PORCENTAJE) VALUES('C', 'LISTA C', 9.4);
INSERT INTO CATEGORIZACION (ID_CATEGORIZACION, NOM_CATEGORIZACION, PORCENTAJE) VALUES('D', 'LISTA D', 7.2);
INSERT INTO CATEGORIZACION (ID_CATEGORIZACION, NOM_CATEGORIZACION, PORCENTAJE) VALUES('E', 'LISTA E', 5.4);


INSERT INTO EMPLEADO (ID_EMPLEADO, RUT_EMPLEADO, NOMBRES, PATERNO, MATERNO, FERNAC, FECCONTRATO, SUELDO, COMISION, ID_EQUIPO, ID_CATEGORIZACION)
VALUES (1, '11111112-6', 'MARY', 'CULVERT', 'RIVERA', '07/08/78', '02/07/00', 350000, 0.25, 'A', 'C');

INSERT INTO EMPLEADO (ID_EMPLEADO, RUT_EMPLEADO, NOMBRES, PATERNO, MATERNO, FERNAC, FECCONTRATO, SUELDO, COMISION, ID_EQUIPO, ID_CATEGORIZACION)
VALUES (2, '12222222-3', 'JEROME', 'WOODS', '', '07/08/78', '02/07/00', 345000, 0.17, 'B', 'B');

INSERT INTO EMPLEADO (ID_EMPLEADO, RUT_EMPLEADO, NOMBRES, PATERNO, MATERNO, FERNAC, FECCONTRATO, SUELDO, COMISION, ID_EQUIPO, ID_CATEGORIZACION)
VALUES (3, '13333333-K', 'NORA', 'BROMSLER', 'OGAZ', '09/10/79', '03/09/01', 367400, 0.25, 'A', 'A');

INSERT INTO EMPLEADO (ID_EMPLEADO, RUT_EMPLEADO, NOMBRES, PATERNO, MATERNO, FERNAC, FECCONTRATO, SUELDO, COMISION, ID_EQUIPO, ID_CATEGORIZACION)
VALUES (4, '14444444-5', 'FREDERICK', 'MALLON', 'PAREDES', '08/12/77', '03/11/99', 373620, 0.12, 'C', 'C');

INSERT INTO EMPLEADO (ID_EMPLEADO, RUT_EMPLEADO, NOMBRES, PATERNO, MATERNO, FERNAC, FECCONTRATO, SUELDO, COMISION, ID_EQUIPO, ID_CATEGORIZACION)
VALUES (5, '15555555-6', 'PAZ', 'GUERRA', '', '22/05/63', '16/04/85', 373620, 0.21, '', 'C');


INSERT INTO FABRICA (ID_FABRICA, NOM_FABRICA) VALUES(SEC_ID_FABRICA.NEXTVAL, 'COSTA');
INSERT INTO FABRICA (ID_FABRICA, NOM_FABRICA) VALUES(SEC_ID_FABRICA.NEXTVAL, 'AMBROSOLI');
INSERT INTO FABRICA (ID_FABRICA, NOM_FABRICA) VALUES(SEC_ID_FABRICA.NEXTVAL, 'NESTLE');
INSERT INTO FABRICA (ID_FABRICA, NOM_FABRICA) VALUES(SEC_ID_FABRICA.NEXTVAL, 'DOS EN UNO');
INSERT INTO FABRICA (ID_FABRICA, NOM_FABRICA) VALUES(SEC_ID_FABRICA.NEXTVAL, 'ARCOR');

INSERT INTO PRODUCTO (ID_PRODUCTO, NOM_PRODUCTO, PRECIO, STOCK_ACTUAL, STOCK_MINIMO, ID_FABRICA) VALUES (1, 'BARRITAS', 250, 150, 110, 5);
INSERT INTO PRODUCTO (ID_PRODUCTO, NOM_PRODUCTO, PRECIO, STOCK_ACTUAL, STOCK_MINIMO, ID_FABRICA) VALUES (2, 'LECHEROS', 325, 50, 30, 5);
INSERT INTO PRODUCTO (ID_PRODUCTO, NOM_PRODUCTO, PRECIO, STOCK_ACTUAL, STOCK_MINIMO, ID_FABRICA) VALUES (3, 'ROSENDOS', 100, 200, 50, 10);
INSERT INTO PRODUCTO (ID_PRODUCTO, NOM_PRODUCTO, PRECIO, STOCK_ACTUAL, STOCK_MINIMO, ID_FABRICA) VALUES (4, 'ZIG ZAG', 375, 50, 20, 15);
INSERT INTO PRODUCTO (ID_PRODUCTO, NOM_PRODUCTO, PRECIO, STOCK_ACTUAL, STOCK_MINIMO, ID_FABRICA) VALUES (5, 'PECADOS', 400, 80, 20, 20);


INSERT INTO BOLETA (ID_BOLETA, ID_CLIENTE, ID_EMPLEADO, FECHA_BOLETA) VALUES (SEC_ID_BOLETA.NEXTVAL, 1, 2, '17/01/22');
INSERT INTO BOLETA (ID_BOLETA, ID_CLIENTE, ID_EMPLEADO, FECHA_BOLETA) VALUES (SEC_ID_BOLETA.NEXTVAL, 2, 4, '17/01/22');
INSERT INTO BOLETA (ID_BOLETA, ID_CLIENTE, ID_EMPLEADO, FECHA_BOLETA) VALUES (SEC_ID_BOLETA.NEXTVAL, 4, 3, '17/01/22');
INSERT INTO BOLETA (ID_BOLETA, ID_CLIENTE, ID_EMPLEADO, FECHA_BOLETA) VALUES (SEC_ID_BOLETA.NEXTVAL, 3, 5, '17/01/22');
INSERT INTO BOLETA (ID_BOLETA, ID_CLIENTE, ID_EMPLEADO, FECHA_BOLETA) VALUES (SEC_ID_BOLETA.NEXTVAL, 2, 2, '17/01/22');

INSERT INTO DETALLE_BOLETA (ID_BOLETA, ID_PRODUCTO, CANTIDAD) VALUES (1010, 1, 10);
INSERT INTO DETALLE_BOLETA (ID_BOLETA, ID_PRODUCTO, CANTIDAD) VALUES (1010, 5, 33);
INSERT INTO DETALLE_BOLETA (ID_BOLETA, ID_PRODUCTO, CANTIDAD) VALUES (1020, 3, 88);
INSERT INTO DETALLE_BOLETA (ID_BOLETA, ID_PRODUCTO, CANTIDAD) VALUES (1020, 4, 33);
INSERT INTO DETALLE_BOLETA (ID_BOLETA, ID_PRODUCTO, CANTIDAD) VALUES (1020, 1, 90);
INSERT INTO DETALLE_BOLETA (ID_BOLETA, ID_PRODUCTO, CANTIDAD) VALUES (1030, 4, 200);
INSERT INTO DETALLE_BOLETA (ID_BOLETA, ID_PRODUCTO, CANTIDAD) VALUES (1030, 2, 500);
INSERT INTO DETALLE_BOLETA (ID_BOLETA, ID_PRODUCTO, CANTIDAD) VALUES (1040, 5, 500);
INSERT INTO DETALLE_BOLETA (ID_BOLETA, ID_PRODUCTO, CANTIDAD) VALUES (1040, 2, 250);
INSERT INTO DETALLE_BOLETA (ID_BOLETA, ID_PRODUCTO, CANTIDAD) VALUES (1040, 3, 300);
INSERT INTO DETALLE_BOLETA (ID_BOLETA, ID_PRODUCTO, CANTIDAD) VALUES (1050, 4, 196);
INSERT INTO DETALLE_BOLETA (ID_BOLETA, ID_PRODUCTO, CANTIDAD) VALUES (1050, 5, 128);
INSERT INTO DETALLE_BOLETA (ID_BOLETA, ID_PRODUCTO, CANTIDAD) VALUES (1050, 2, 181);


